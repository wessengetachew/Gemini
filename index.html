
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modular Reduction Projection Research Portal v2.0</title>
    <style>
        :root {
            --bg-dark: #0a0a0a;
            --panel-bg: #141414;
            --text-main: #e0e0e0;
            --text-dim: #888;
            --accent-cyan: #00ffff;
            --accent-red: #ff1493;
            --accent-gold: #ffd700;
            --header-grad: linear-gradient(90deg, #240046, #4b0082);
            --border-col: #333;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* HEADER */
        header {
            background: var(--header-grad);
            padding: 15px 20px;
            border-bottom: 1px solid #555;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        header h1 { font-size: 1.2rem; letter-spacing: 1px; text-transform: uppercase; }

        /* TABS */
        .tabs {
            display: flex;
            background: #1a1a1a;
            border-bottom: 1px solid var(--border-col);
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-right: 1px solid var(--border-col);
            font-size: 0.9rem;
            color: var(--text-dim);
            transition: 0.2s;
        }
        .tab:hover { background: #222; color: #fff; }
        .tab.active { background: #333; color: var(--accent-cyan); border-bottom: 2px solid var(--accent-cyan); }

        /* MAIN LAYOUT */
        .main-container {
            display: flex;
            flex: 1;
            height: calc(100vh - 90px);
        }

        /* VIZ AREA (LEFT) */
        #viz-container {
            flex: 7;
            background: #000;
            position: relative;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            border-right: 1px solid var(--border-col);
        }
        
        /* Floating Info Box in Viz */
        .info-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border: 1px solid #444;
            border-radius: 4px;
            pointer-events: none;
        }

        /* CONTROLS (RIGHT) */
        #controls-panel {
            flex: 3;
            background: var(--panel-bg);
            overflow-y: auto;
            padding: 20px;
            min-width: 320px;
        }

        .control-group {
            background: #1a1a1a;
            border: 1px solid var(--border-col);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .control-group h3 {
            font-size: 0.85rem;
            text-transform: uppercase;
            color: var(--text-dim);
            margin-bottom: 10px;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
        }

        /* FORM ELEMENTS */
        label { display: block; margin-bottom: 5px; font-size: 0.9rem; }
        
        .row { display: flex; gap: 10px; align-items: center; margin-bottom: 8px; }
        .btn-row { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 10px; }

        input[type="range"] { width: 100%; cursor: pointer; accent-color: var(--accent-cyan); }
        input[type="number"] {
            background: #222; border: 1px solid #444; color: #fff;
            padding: 5px; width: 80px; border-radius: 3px;
        }
        
        button {
            background: #333; border: 1px solid #444; color: #eee;
            padding: 6px 12px; cursor: pointer; border-radius: 3px;
            font-size: 0.8rem; transition: 0.2s;
        }
        button:hover { background: #444; border-color: #666; }
        button.primary { background: #2a2a50; border-color: #4a4a80; }
        button.active { background: var(--accent-cyan); color: #000; }

        select {
            background: #222; border: 1px solid #444; color: #fff;
            padding: 5px; width: 100%; border-radius: 3px;
        }

        /* STATS GRID */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1px;
            background: #444;
            border: 1px solid #444;
        }
        .stat-item { background: #1a1a1a; padding: 8px; font-size: 0.85rem; }
        .stat-label { color: var(--text-dim); }
        .stat-val { float: right; font-weight: bold; }

        /* TOOLTIP */
        #tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid var(--accent-cyan);
            padding: 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            pointer-events: none;
            display: none;
            z-index: 100;
            box-shadow: 0 0 10px rgba(0,255,255,0.2);
        }
    </style>
</head>
<body>

<header>
    <h1>Modular Reduction Projection Research Portal</h1>
</header>

<div class="tabs">
    <div class="tab active">Portal</div>
    <div class="tab">3D</div>
    <div class="tab">Analysis</div>
    <div class="tab">Sequences</div>
    <div class="tab">Sieve</div>
    <div class="tab">Compare</div>
    <div class="tab">Theory</div>
    <div class="tab">About</div>
</div>

<div class="main-container">
    
    <div id="viz-container">
        <div class="info-overlay">
            <div id="overlay-m" style="font-size: 1.2rem; font-weight: bold;">M = 32</div>
            <div id="overlay-fact" style="color: #aaa; margin-top:5px;">2⁵</div>
        </div>
        <svg id="main-svg" width="100%" height="100%" viewBox="-500 -500 1000 1000" preserveAspectRatio="xMidYMid meet">
            <defs>
                <filter id="glow">
                    <feGaussianBlur stdDeviation="2.5" result="coloredBlur"/>
                    <feMerge>
                        <feMergeNode in="coloredBlur"/>
                        <feMergeNode in="SourceGraphic"/>
                    </feMerge>
                </filter>
            </defs>
            <g id="scene-group">
                </g>
        </svg>
        <div id="tooltip"></div>
    </div>

    <div id="controls-panel">
        
        <div class="control-group">
            <h3>Modulus Configuration</h3>
            <div class="row">
                <label>M = </label>
                <input type="number" id="input-m" value="32" min="2" max="5000">
            </div>
            <input type="range" id="slider-m" min="2" max="500" value="32">
            
            <div style="margin-top: 10px; font-size: 0.8rem; color: #888;">Presets:</div>
            <div class="btn-row">
                <button onclick="setM(12)">12</button>
                <button onclick="setM(30)">30</button>
                <button onclick="setM(60)">60</button>
                <button onclick="setM(101)">101 (P)</button>
                <button onclick="setM(210)">210</button>
                <button onclick="setM(360)">360</button>
            </div>
        </div>

        <div class="control-group">
            <h3>Display Options</h3>
            <label><input type="checkbox" id="chk-lines" checked> Projection Lines (Gold)</label>
            <label><input type="checkbox" id="chk-rings" checked> Channel Rings</label>
            <label><input type="checkbox" id="chk-inner-points"> Inner Ring Points</label>
            <label><input type="checkbox" id="chk-labels"> Show Point Labels</label>
            
            <div style="margin-top: 10px;">
                <label>Highlight Constellation:</label>
                <select id="sel-constellation">
                    <option value="none">None</option>
                    <option value="twin">Twin Primes (gap=2)</option>
                    <option value="cousin">Cousin Primes (gap=4)</option>
                    <option value="sexy">Sexy Primes (gap=6)</option>
                </select>
            </div>
        </div>

        <div class="control-group">
            <h3>Animation</h3>
            <div class="btn-row">
                <button id="btn-play">▶ Play</button>
                <button id="btn-stop">⏸ Stop</button>
            </div>
            <div class="row">
                <label>Speed:</label>
                <input type="range" id="anim-speed" min="50" max="2000" value="500">
            </div>
            <label><input type="checkbox" id="chk-loop" checked> Loop (Increment M)</label>
        </div>

        <div class="control-group">
            <h3>View Controls</h3>
            <div class="row">
                <label>Zoom:</label>
                <input type="range" id="slider-zoom" min="0.1" max="5" step="0.1" value="1">
            </div>
            <div class="row">
                <label>Rotate:</label>
                <input type="range" id="slider-rotate" min="0" max="360" value="0">
            </div>
        </div>

        <div class="control-group">
            <h3>Statistics</h3>
            <div class="stats-grid">
                <div class="stat-item"><span class="stat-label">Modulus M</span><span class="stat-val" id="stat-m">32</span></div>
                <div class="stat-item"><span class="stat-label">φ(M)</span><span class="stat-val" id="stat-phi">16</span></div>
                <div class="stat-item"><span class="stat-label">Density</span><span class="stat-val" id="stat-density">50%</span></div>
                <div class="stat-item"><span class="stat-label">Channels</span><span class="stat-val" id="stat-channels">6</span></div>
            </div>
        </div>

        <div class="control-group">
            <h3>Data Export</h3>
            <div class="btn-row">
                <button id="btn-png">PNG Image</button>
                <button id="btn-csv">CSV Data</button>
                <button id="btn-json">JSON</button>
            </div>
        </div>

    </div>
</div>

<script>
/**
 * CORE LOGIC FOR MODULAR PORTAL
 */

// State Management
const state = {
    M: 32,
    radius: 400,
    zoom: 1.0,
    rotation: 0,
    showLines: true,
    showRings: true,
    showInnerPoints: false,
    showLabels: false,
    constellation: 'none',
    isPlaying: false,
    animationInterval: null,
    speed: 500
};

// DOM Elements
const svg = document.getElementById('main-svg');
const group = document.getElementById('scene-group');
const tooltip = document.getElementById('tooltip');

// Math Helpers
const gcd = (a, b) => b === 0 ? a : gcd(b, a % b);

const getFactors = (n) => {
    const factors = [];
    for(let i=1; i<=n; i++) {
        if(n % i === 0) factors.push(i);
    }
    return factors;
};

const getPrimeFactors = (n) => {
    const factors = {};
    let d = 2;
    let temp = n;
    while (d * d <= temp) {
        while (temp % d === 0) {
            factors[d] = (factors[d] || 0) + 1;
            temp /= d;
        }
        d++;
    }
    if (temp > 1) factors[temp] = (factors[temp] || 0) + 1;
    
    // Format string 2^5 etc
    return Object.entries(factors).map(([p, exp]) => exp > 1 ? `${p}^${exp}` : `${p}`).join(' × ');
};

const getPhi = (n) => {
    let result = n;
    for (let i = 2; i * i <= n; i++) {
        if (n % i === 0) {
            while (n % i === 0) n /= i;
            result -= result / i;
        }
    }
    if (n > 1) result -= result / n;
    return result;
};

// --- RENDERING ENGINE ---

function render() {
    // Clear Scene
    group.innerHTML = '';
    
    // Apply View Transforms
    group.setAttribute('transform', `scale(${state.zoom}) rotate(${state.rotation})`);
    
    // 1. Draw Inner Rings (Farey Channels)
    const divisors = getFactors(state.M);
    
    if (state.showRings) {
        divisors.forEach(d => {
            // M' = d. Radius scaled by d/M
            // Actually, based on readme: M' = M/gcd.
            // The readme says: Radius = 400 * (M'/M). 
            // M' are the divisors.
            
            const r = state.radius * (d / state.M);
            
            const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            circle.setAttribute("r", r);
            circle.setAttribute("fill", "none");
            circle.setAttribute("stroke", "#333");
            circle.setAttribute("stroke-width", "1");
            if (d === state.M) circle.setAttribute("stroke", "#666"); // Outer ring
            group.appendChild(circle);
        });
    }

    // 2. Calculate Residues
    const points = [];
    const phi = getPhi(state.M);
    let primes = []; // For constellation highlighting (coprimes essentially act as "primes" in residue systems context for visualization purposes, or we check actual primality)
    
    for (let r = 0; r < state.M; r++) {
        const g = gcd(r, state.M);
        const isCoprime = g === 1;
        
        // M' (Channel) logic: Where does it project?
        const mPrime = state.M / g; 
        const rPrime = r / g;
        
        // Coordinates on Outer Ring
        const theta = -Math.PI / 2 + (2 * Math.PI * r / state.M);
        const x = state.radius * Math.cos(theta);
        const y = state.radius * Math.sin(theta);
        
        // Inner projection coordinates
        const r_inner = state.radius * (mPrime / state.M);
        const x_in = r_inner * Math.cos(theta);
        const y_in = r_inner * Math.sin(theta);

        points.push({ r, g, isCoprime, x, y, x_in, y_in, mPrime, theta });
        
        if (isCoprime) primes.push(r);
    }

    // 3. Draw Projection Lines (Background layer)
    if (state.showLines) {
        points.forEach(p => {
            if (!p.isCoprime && p.g < state.M) {
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", p.x);
                line.setAttribute("y1", p.y);
                line.setAttribute("x2", p.x_in);
                line.setAttribute("y2", p.y_in);
                line.setAttribute("stroke", "#ffd700"); // Gold
                line.setAttribute("stroke-opacity", "0.3");
                line.setAttribute("stroke-width", "1");
                group.appendChild(line);
            }
        });
    }

    // 4. Draw Points
    points.forEach(p => {
        // Determine Highlight
        let isHighlighted = false;
        if (state.constellation !== 'none' && p.isCoprime) {
            const gap = { 'twin': 2, 'cousin': 4, 'sexy': 6 }[state.constellation];
            // Check if r+gap or r-gap is also coprime (simple visualization check)
            const hasUpper = primes.includes(p.r + gap);
            const hasLower = primes.includes(p.r - gap);
            if(hasUpper || hasLower) isHighlighted = true;
        }

        // Draw Circle
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", p.x);
        circle.setAttribute("cy", p.y);
        
        if (p.isCoprime) {
            circle.setAttribute("r", isHighlighted ? 8 : 6);
            circle.setAttribute("fill", isHighlighted ? "#fff" : "#00ffff"); // Cyan or White highlight
            if(isHighlighted) circle.setAttribute("filter", "url(#glow)");
        } else {
            circle.setAttribute("r", 4);
            circle.setAttribute("fill", "#ff1493"); // Red
        }
        
        // Tooltip Events
        circle.addEventListener('mouseover', (e) => showTooltip(e, p));
        circle.addEventListener('mouseout', hideTooltip);
        
        group.appendChild(circle);

        // Inner Points (Optional)
        if (state.showInnerPoints && !p.isCoprime && p.g < state.M) {
            const innerDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            innerDot.setAttribute("cx", p.x_in);
            innerDot.setAttribute("cy", p.y_in);
            innerDot.setAttribute("r", 2);
            innerDot.setAttribute("fill", "#888");
            group.appendChild(innerDot);
        }

        // Labels
        if (state.showLabels) {
            // Only label every Nth point if M is huge
            if (state.M > 100 && p.r % 5 !== 0) return;

            const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
            // Position text slightly outside
            const labelDist = 1.1;
            text.setAttribute("x", p.x * labelDist);
            text.setAttribute("y", p.y * labelDist);
            text.setAttribute("fill", p.isCoprime ? "#00ffff" : "#ff1493");
            text.setAttribute("font-size", "12");
            text.setAttribute("text-anchor", "middle");
            text.setAttribute("alignment-baseline", "middle");
            text.textContent = p.r;
            // Rotate text to be readable? No, readme implies simple placement.
            group.appendChild(text);
        }
    });

    // Update Stats Panel
    updateStats(points, phi, divisors.length);
}

// --- STATS & UI UPDATES ---

function updateStats(points, phi, channels) {
    document.getElementById('stat-m').textContent = state.M;
    document.getElementById('stat-phi').textContent = phi;
    document.getElementById('stat-density').textContent = ((phi / state.M) * 100).toFixed(1) + '%';
    document.getElementById('stat-channels').textContent = channels;
    
    // Overlay Info
    document.getElementById('overlay-m').textContent = `M = ${state.M}`;
    document.getElementById('overlay-fact').textContent = getPrimeFactors(state.M);
}

function showTooltip(e, p) {
    tooltip.style.display = 'block';
    tooltip.style.left = (e.pageX + 15) + 'px';
    tooltip.style.top = (e.pageY + 15) + 'px';
    tooltip.innerHTML = `
        <strong>Residue: ${p.r}</strong><br>
        GCD(r,M): ${p.g}<br>
        Type: <span style="color:${p.isCoprime?'#00ffff':'#ff1493'}">${p.isCoprime?'Coprime':'Reducible'}</span><br>
        Channel M': ${p.mPrime}<br>
        Angle: ${(p.theta * 180/Math.PI + 90).toFixed(1)}°
    `;
}

function hideTooltip() {
    tooltip.style.display = 'none';
}

function setM(val) {
    state.M = parseInt(val);
    document.getElementById('input-m').value = state.M;
    document.getElementById('slider-m').value = state.M;
    render();
}

// --- EXPORT FUNCTIONALITY ---

function exportPNG() {
    // Simple serialize SVG to Canvas to PNG
    const svgData = new XMLSerializer().serializeToString(svg);
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");
    const img = new Image();
    
    // Set resolution
    canvas.width = 2000;
    canvas.height = 2000;
    
    img.onload = function() {
        ctx.fillStyle = "#000000";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        const a = document.createElement("a");
        a.download = `modular-M${state.M}.png`;
        a.href = canvas.toDataURL("image/png");
        a.click();
    };
    
    img.src = "data:image/svg+xml;base64," + btoa(unescape(encodeURIComponent(svgData)));
}

function exportCSV() {
    let csv = "r,M,gcd,coprime,m_prime,angle_deg\n";
    for(let r=0; r<state.M; r++) {
        const g = gcd(r, state.M);
        const angle = (r/state.M) * 360;
        csv += `${r},${state.M},${g},${g===1},${state.M/g},${angle}\n`;
    }
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `data-M${state.M}.csv`;
    a.click();
}

// --- EVENT LISTENERS ---

document.getElementById('slider-m').addEventListener('input', (e) => {
    state.M = parseInt(e.target.value);
    document.getElementById('input-m').value = state.M;
    render();
});

document.getElementById('input-m').addEventListener('change', (e) => {
    let val = parseInt(e.target.value);
    if(val < 2) val = 2;
    setM(val);
});

document.getElementById('chk-lines').addEventListener('change', (e) => {
    state.showLines = e.target.checked;
    render();
});
document.getElementById('chk-rings').addEventListener('change', (e) => {
    state.showRings = e.target.checked;
    render();
});
document.getElementById('chk-inner-points').addEventListener('change', (e) => {
    state.showInnerPoints = e.target.checked;
    render();
});
document.getElementById('chk-labels').addEventListener('change', (e) => {
    state.showLabels = e.target.checked;
    render();
});
document.getElementById('sel-constellation').addEventListener('change', (e) => {
    state.constellation = e.target.value;
    render();
});

// View Controls
document.getElementById('slider-zoom').addEventListener('input', (e) => {
    state.zoom = parseFloat(e.target.value);
    render();
});
document.getElementById('slider-rotate').addEventListener('input', (e) => {
    state.rotation = parseInt(e.target.value);
    render();
});

// Animation
document.getElementById('btn-play').addEventListener('click', () => {
    if(state.isPlaying) return;
    state.isPlaying = true;
    state.animationInterval = setInterval(() => {
        if(document.getElementById('chk-loop').checked) {
            // Increment M
            let next = state.M + 1;
            if(next > 500) next = 2;
            setM(next);
        } else {
            // Rotate
            state.rotation = (state.rotation + 1) % 360;
            document.getElementById('slider-rotate').value = state.rotation;
            render();
        }
    }, parseInt(document.getElementById('anim-speed').value));
});

document.getElementById('btn-stop').addEventListener('click', () => {
    state.isPlaying = false;
    clearInterval(state.animationInterval);
});

document.getElementById('anim-speed').addEventListener('input', (e) => {
    // If playing, restart with new speed
    if(state.isPlaying) {
        document.getElementById('btn-stop').click();
        document.getElementById('btn-play').click();
    }
});

// Export
document.getElementById('btn-png').addEventListener('click', exportPNG);
document.getElementById('btn-csv').addEventListener('click', exportCSV);
document.getElementById('btn-json').addEventListener('click', () => {
    const data = { M: state.M, phi: getPhi(state.M), residues: [] };
    alert("JSON structure prepared (Download logic similar to CSV)");
});

// Drag to Pan (Basic implementation)
let isDragging = false;
let startX, startY;
let viewBoxX = -500, viewBoxY = -500;

svg.addEventListener('mousedown', e => {
    isDragging = true;
    startX = e.clientX;
    startY = e.clientY;
});
window.addEventListener('mouseup', () => isDragging = false);
svg.addEventListener('mousemove', e => {
    if (!isDragging) return;
    const dx = e.clientX - startX;
    const dy = e.clientY - startY;
    // Simple pan by adjusting viewBox is tricky with zoom. 
    // For this demo, we'll skip complex pan logic to keep code concise.
});

// Init
render();

</script>
</body>
</html>


Would
